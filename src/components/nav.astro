---
const base = import.meta.env.BASE_URL; // "/" en dev, "/capitoken-site/" en build

const LINKS = [
  { label: "Launch", href: "#launch" },
  { label: "Tokenomics", href: "#tokenomics" },
  { label: "Roadmap", href: "#roadmap" },
  { label: "Links", href: "/links" }, // en build queda bajo /capitoken-site/
  { label: "FAQ", href: "#faq" },
];

// Home detection:
// - "/" en dev
// - "/capitoken-site/" en GitHub Pages
const pathname = Astro.url.pathname;
const isHome = pathname === base || pathname === "/" || pathname === base.replace(/\/$/, "");

function fixHref(href: string) {
  // Anchor links se quedan tal cual
  if (href.startsWith("#")) return href;

  // Links absolutos (http) se dejan
  if (href.startsWith("http")) return href;

  // Forzar base en rutas internas
  const clean = href.startsWith("/") ? href.slice(1) : href;
  return `${base}${clean}`.replace(/\/{2,}/g, "/");
}
---

<header class="nav">
  <div class="nav__inner">
    <!-- Brand siempre vuelve al HOME bajo BASE_URL -->
    <a class="brand" href={base}>
      <span class="brand__dot" aria-hidden="true"></span>
      <span class="brand__name">Capitoken</span>
    </a>

    <nav class="nav__links" aria-label="Primary">
      {LINKS.map((l) => (
        <a href={fixHref(l.href)} class={l.href.startsWith("#") && !isHome ? "is-disabled" : ""}>
          {l.label}
        </a>
      ))}
    </nav>
  </div>
</header>
