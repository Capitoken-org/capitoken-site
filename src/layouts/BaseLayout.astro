---
import Nav from "../components/nav.astro";

const { title = "Capitoken", description = "" } = Astro.props;

const BASE = import.meta.env.BASE_URL ?? "/";
const withBase = (p: string) => `${BASE}${p.replace(/^\/+/, "")}`;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <meta name="theme-color" content="#0f5c4a" />

    <!-- Favicons / PWA -->
    <link rel="icon" type="image/png" sizes="32x32" href={withBase("icons/favicon-32x32.png")} />
    <link rel="icon" type="image/png" sizes="16x16" href={withBase("icons/favicon-16x16.png")} />
    <link rel="apple-touch-icon" sizes="180x180" href={withBase("icons/apple-touch-icon.png")} />
    <link rel="manifest" href={withBase("site.webmanifest")} />

    <!-- GLOBAL CSS (public/global.css) -->
    <link rel="stylesheet" href={withBase("global.css")} />
  </head>

  <body>
    <Nav />
    <main>
      <slot />
    </main>

    <script>
      // Copy handler (data-copy)
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-copy]");
        if (!btn) return;
        navigator.clipboard.writeText(btn.dataset.copy);
      });

      // Watch token (MetaMask)
      document.addEventListener("click", async (e) => {
        const t = e.target.closest("#watchTokenBtn");
        if (!t) return;

        if (!window.ethereum) {
          alert("MetaMask not detected");
          return;
        }

        try {
          await ethereum.request({
            method: "wallet_watchAsset",
            params: {
              type: "ERC20",
              options: {
                address: "0x0000000000000000000000000000000000000000",
                symbol: "CAPI",
                decimals: 18,
              },
            },
          });
        } catch (err) {
          console.error(err);
        }
      });
    </script>
  </body>
</html>
