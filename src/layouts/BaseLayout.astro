---
import Nav from "../components/nav.astro";

const title = Astro.props.title || "Capitoken (CAPI)";
const description =
  Astro.props.description ||
  "Capitoken official website — verified info, on-chain transparency, and a community-owned future.";

const BASE = import.meta.env.BASE_URL || "/";
const withBase = (p) => {
  const clean = String(p || "");
  return clean.startsWith("/") ? `${BASE}${clean.slice(1)}` : `${BASE}${clean}`;
};

// Cache-bust for GitHub Pages / CDN
const CSS_VERSION = "41";
const JS_VERSION = "40";

const year = 2025;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <title>{title}</title>

    <link rel="icon" href={withBase("/favicon.ico")} />
    <link rel="stylesheet" href={withBase(`/global.css?v=${CSS_VERSION}`)} />
  </head>

  <body>
    <Nav />
    <main>
      <slot />
    </main>

    <footer class="footer">
      <div class="container">
        <div class="footer__disclaimer">
  <p><strong>Disclaimer:</strong> Capitoken (CAPI) is an experimental crypto asset and community project. Capitoken.org is an informational website only. We are <strong>not</strong> a financial institution, bank, broker, exchange, custodian, money-services business, or investment adviser. Nothing on this website constitutes (or should be construed as) financial, legal, tax, or investment advice.</p>
  <p>No content on this website is an offer, solicitation, recommendation, endorsement, or promise of returns. Crypto assets are highly volatile and involve significant risk — you may lose <strong>all</strong> funds. You are solely responsible for conducting your own research (DYOR) and for any decisions, transactions, or interactions with smart contracts and third-party services.</p>
  <p>All information is provided “as is” without warranties of any kind. Third-party links (including explorers, DEXs, and social platforms) are provided for convenience; we do not control or guarantee their availability, accuracy, or security.</p>
</div>
        <div class="footer__copyright">© {year} Capitoken.org • All rights reserved</div>
      </div>
    </footer>

    <!-- Site JS (modules to allow import/export and import.meta usage) -->
    <script type="module" src={withBase(`/js/capi-config.js?v=${JS_VERSION}`)}></script>
    <script type="module" src={withBase(`/js/trust-engine.js?v=${JS_VERSION}`)}></script>
    <script type="module" src={withBase(`/js/market-engine.js?v=${JS_VERSION}`)}></script>
    <script type="module" src={withBase(`/js/capi-wallets.js?v=${JS_VERSION}`)}></script>
    <script type="module" src={withBase(`/js/capi-dex.js?v=${JS_VERSION}`)}></script>
    <script type="module" src={withBase(`/js/capi-ui.js?v=${JS_VERSION}`)}></script>
    <script type="module" src={withBase(`/js/renounce-countdown.js?v=${JS_VERSION}`)}></script>
      <script type="module" src={withBase(`/js/ticker.js?v=${JS_VERSION}`)}></script>

    <!--
      Anchor offset fix:
      The header is a stacked sticky block (top row + socials + ticker).
      We measure its real height and set --nav-h so hash navigation doesn't
      land section titles under the navbar.
    -->
    <script>
      (() => {
        const setNavOffset = () => {
          const header = document.querySelector('header.nav');
          if (!header) return;
          const h = Math.ceil(header.getBoundingClientRect().height);
          // Guard against weird zero heights during early paint
          if (h > 60) document.documentElement.style.setProperty('--nav-h', `${h}px`);
        };

        // Run early + after layout settles
        document.addEventListener('DOMContentLoaded', () => {
          setNavOffset();
          requestAnimationFrame(setNavOffset);
          setTimeout(setNavOffset, 250);
        });

        // Recompute on resize/orientation changes
        window.addEventListener('resize', () => {
          setNavOffset();
          requestAnimationFrame(setNavOffset);
        }, { passive: true });

        // If images/fonts shift header height
        window.addEventListener('load', () => {
          setNavOffset();
          requestAnimationFrame(setNavOffset);
        });
      })();
    </script>
</body>
</html>
