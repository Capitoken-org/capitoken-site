---
import BaseLayout from "../layouts/BaseLayout.astro";

const TITLE = "Capitoken (CAPI) — Official Website";
const DESC =
  "Capitoken official website — verified links, live-ready launch panel, tokenomics, roadmap, and community updates.";

// >>> EDITA AQUÍ cuando tengas data real <<<
const TOKEN_ADDRESS = ""; // "0x..." (ETH mainnet)
const DEX_PAIR_ADDRESS = ""; // opcional
const X_HANDLE = "Capitoken"; // sin @ (ej: "Capitoken")
// >>> ------------------------------ <<<

const stats = [
  { label: "Chain", value: "Ethereum Mainnet" },
  { label: "Status", value: "Building" },
  { label: "Focus", value: "Community-first" },
  { label: "Symbol", value: "CAPI" },
];

const tokenomics = [
  { title: "97% Community", desc: "Broad distribution & liquidity-first mindset." },
  { title: "2% Operations", desc: "Sustains development, infra, and execution." },
  { title: "1% Marketing", desc: "Growth loops, listings, and content." },
];

const roadmap = [
  { phase: "Phase 1", title: "Foundation", items: ["Brand + Website", "Docs/Whitepaper", "Official channels live"] },
  { phase: "Phase 2", title: "Launch Prep", items: ["Final checks", "DEX readiness", "Verified links live"] },
  { phase: "Phase 3", title: "Expansion", items: ["Listings", "Ecosystem features", "Partnerships"] },
];

function shortAddr(a: string) {
  if (!a) return "TBA";
  return `${a.slice(0, 6)}…${a.slice(-4)}`;
}
---

<BaseLayout title={TITLE} description={DESC}>
  <!-- HERO -->
  <section class="hero hero--banner" id="launch">
    <div class="container reveal reveal--2">
    <div class="hero__kicker">
      <span class="pill__dot" aria-hidden="true"></span>
      Verified info only on this website
    </div>

    <h1>
      Capitoken is building a <span style="color: var(--accent)">community-first</span> memecoin ecosystem.
    </h1>

    <p class="hero__lead">
      Deep-green premium design, clear narrative, and verified links — built for adoption.
      Live market data will appear automatically once the verified contract/pair is published.
    </p>

    <div class="actions">
      <a class="btn btn--primary" href="#launchpanel">Launch Panel</a>
      <a class="btn" href="#community">Community</a>
      <a class="btn" href="#tokenomics">Tokenomics</a>
    </div>

    <div class="grid" style="margin-top: 18px;">
      {stats.map((s) => (
        <div class="card col-3">
          <div class="small">{s.label}</div>
          <div style="margin-top:6px; font-weight:800;">{s.value}</div>
        </div>
      ))}
    </div>
  </div>
  </section>

  <hr class="hr" />

  <!-- LAUNCH PANEL -->
<section class="section" id="launchpanel">
  <div class="container reveal reveal--3">
    <h2>Launch Panel</h2>
    <p class="small">Single source of truth for contract, DEX pair, and status.</p>

    <div class="launch-grid">
      <!-- Contract -->
      <div class="card">
        <div class="label">Contract</div>
        <div class="mono" id="contractText">TBA — verify only here</div>

        <div class="actions" style="margin-top:10px;">
          <button class="btn btn-primary" data-copy="contract" id="copyContractBtn">Copy</button>
          <a class="btn" href="/capitoken-site/verify/" id="verifyContractBtn">Verify</a>
        </div>

        <div class="actions" style="margin-top:10px;">
          <button class="btn" id="connectWalletBtn" type="button">Connect Wallet</button>
          <a class="btn" id="watchTokenBtn" href="#" rel="nofollow noopener">Watch Token</a>
        </div>

        <div class="pill" id="accountPill" style="margin-top:10px; display:none;">
          <span class="pill__dot" aria-hidden="true"></span>
          <span class="mono" id="acct"></span>
        </div>

        <p class="small" style="margin-top:12px;">
          Security note: Scammers will copy names and logos. Verify contract + links ONLY here.
        </p>
      </div>

      <!-- DEX Pair -->
      <div class="card">
        <div class="label">DEX Pair</div>
        <div class="mono" id="pairText">TBA</div>

        <div class="actions" style="margin-top:10px;">
          <button class="btn btn-primary" data-copy="pair" id="copyPairBtn">Copy</button>
          <a class="btn" href="/capitoken-site/verify/" id="verifyPairBtn">Verify</a>
        </div>

        <div class="small" style="margin-top:12px;">Quick Uniswap routes (V2)</div>
        <div class="route-actions">
          <a class="btn route-btn" id="dexWethToCapi" href="#" rel="nofollow noopener">WETH → CAPI</a>
          <a class="btn route-btn" id="dexCapiToWeth" href="#" rel="nofollow noopener">CAPI → WETH</a>
        </div>
      </div>

      <!-- Live Market Snapshot -->
      <div class="card span-all">
        <div class="h3">Live Market Snapshot</div>
        <div class="small">Auto-populates via DexScreener once contract/pair is verified.</div>

        <div class="pill" style="margin-top:10px;">
          <span class="pill__dot" aria-hidden="true"></span>
          <span>Ethereum Mainnet</span>
        </div>

        <div class="stats" style="margin-top:14px;">
          <div class="stat"><div class="k">Price</div><div class="v" id="m_price">TBA</div></div>
          <div class="stat"><div class="k">Market Cap (est.)</div><div class="v" id="m_mc">TBA</div></div>
          <div class="stat"><div class="k">Liquidity</div><div class="v" id="m_liq">TBA</div></div>
          <div class="stat"><div class="k">24h Volume</div><div class="v" id="m_vol">TBA</div></div>
        </div>

        <p class="small" style="margin-top:12px;">If it's not listed here, it's not official. Always cross-check the URL.</p>
      </div>

      <!-- Recent Activity -->
      <div class="card span-all">
        <div class="h3">Recent Activity</div>
        <div class="small">Shows recent activity (placeholder until contract is published).</div>

        <div class="table-wrap" style="margin-top:12px;">
          <table class="table">
            <thead>
              <tr><th>From</th><th>To</th><th>Amount</th><th>TX</th></tr>
            </thead>
            <tbody id="txBody">
              <tr><td class="mono">TBA</td><td class="mono">TBA</td><td class="mono">TBA</td><td class="mono">TBA</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</section>


<hr class="hr" />



  <!-- TOKENOMICS -->
  <section class="section" id="tokenomics">
    <div class="container reveal">
    <h2>Tokenomics</h2>
    <p>Simple allocation — 97 / 2 / 1.</p>

    <div class="grid" style="margin-top:14px;">
      {tokenomics.map((t) => (
        <div class="card col-6">
          <h3>{t.title}</h3>
          <p>{t.desc}</p>
          <div style="margin-top:12px; height:4px; width:72px; border-radius:999px; background: rgba(248,168,64,0.55);"></div>
        </div>
      ))}
      <div class="card col-12">
        <div class="kv"><strong>Community</strong><span>97%</span></div>
        <div class="kv"><strong>Operations</strong><span>2%</span></div>
        <div class="kv"><strong>Marketing</strong><span>1%</span></div>
      </div>
    </div>
  </div>
  </section>

  <hr class="hr" />

  <!-- ROADMAP -->
  <section class="section" id="roadmap">
    <div class="container reveal">
    <h2>Roadmap</h2>
    <p>Focused phases with clear deliverables.</p>

    <div class="grid" style="margin-top:14px;">
      {roadmap.map((r) => (
        <div class="card col-6">
          <div class="small">{r.phase}</div>
          <div style="margin-top:6px; font-weight:900; font-size:18px;">{r.title}</div>
          <ul style="margin:12px 0 0 0; padding-left: 18px; color: var(--muted);">
            {r.items.map((i) => <li style="margin: 6px 0;">{i}</li>)}
          </ul>
        </div>
      ))}
    </div>
  </div>
  </section>

  <hr class="hr" />

  <!-- DAILY CAPI / NARRATIVE -->
  <section class="section" id="daily">
    <div class="container reveal">
    <h2>Daily Capi</h2>
    <p>
      Short daily thoughts we can recycle to X/Twitter, plus community prompts. (We can later convert this into a real blog.)
    </p>

    <div class="grid" style="margin-top:14px;">
      <div class="card col-6">
        <h3>Today’s prompt</h3>
        <p class="small">What should the community prioritize next: memes, utility, listings, or partnerships?</p>
        <a class="btn btn--primary" href={`https://twitter.com/${X_HANDLE}`} target="_blank" rel="noreferrer">Reply on X</a>
      </div>
      <div class="card col-6">
        <h3>Build in public</h3>
        <p class="small">We publish verified updates here first, then mirror them to socials. Bookmark this page.</p>
        <a class="btn" href="#launchpanel">Back to Launch Panel</a>
      </div>
    </div>
  </div>
  </section>

  <hr class="hr" />

  <!-- COMMUNITY -->
  <section class="section" id="community">
    <div class="container reveal">
    <h2>Community</h2>
    <p>
      Live social embeds + feedback loop. Next step: add Discord/Telegram widgets once your official URLs are final.
    </p>

    <div class="grid" style="margin-top:14px;">
      <div class="card col-12">
        <h3>Official X feed</h3>
        <p class="small">If this embed is blank, your browser/extensions may block it. The link still works.</p>

        <a class="btn btn--primary" href={`https://twitter.com/${X_HANDLE}`} target="_blank" rel="noreferrer">
          Open X profile
        </a>

        <div style="margin-top:14px;">
          <a class="twitter-timeline"
             data-theme="dark"
             data-tweet-limit="3"
             href={`https://twitter.com/${X_HANDLE}`}>
             Tweets by {X_HANDLE}
          </a>
        </div>
      </div>
    </div>
  </div>
  </section>

  <hr class="hr" />

  <!-- FAQ -->
  <section class="section" id="faq">
    <div class="container reveal">
    <h2>FAQ</h2>

    <div class="grid" style="margin-top:14px;">
      <div class="card col-6">
        <h3>Where is the official contract?</h3>
        <p class="small">We publish the verified contract address in the Launch Panel and Official Links.</p>
      </div>

      <div class="card col-6">
        <h3>Is this financial advice?</h3>
        <p class="small">No. Crypto is high risk. Always do your own research.</p>
      </div>

      <div class="card col-6">
        <h3>Why verify only here?</h3>
        <p class="small">Scammers frequently clone brands. This site is the single source of truth for official links.</p>
      </div>

      <div class="card col-6">
        <h3>When live market data?</h3>
        <p class="small">As soon as the verified contract/pair is published, live metrics auto-populate.</p>
      </div>
    </div>
  </div>
  </section>

  <!-- X widget loader -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  <!-- Live + Wallet script -->
  <script type="module" define:vars={{ TOKEN_ADDRESS, DEX_PAIR_ADDRESS }}>
    const $ = (s) => document.querySelector(s);

    
const toast = (msg) => {
  const el = $("#toast");
  if(!el) return;
  el.textContent = msg;
  el.classList.add("toast--show");
  clearTimeout(window.__toastT);
  window.__toastT = setTimeout(()=> el.classList.remove("toast--show"), 1800);
};

async function copyText(val){
  if(!val) return;
  try{
    await navigator.clipboard.writeText(val);
    toast("Copied");
  }catch(e){
    // fallback
    const ta = document.createElement("textarea");
    ta.value = val;
    ta.setAttribute("readonly","");
    ta.style.position="absolute";
    ta.style.left="-9999px";
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    toast("Copied");
  }
}
function short(a){
      if(!a) return "";
      return a.slice(0,6)+"…"+a.slice(-4);
    }

    function fmtUSD(n, d=2){
      if(n === null || n === undefined || Number.isNaN(Number(n))) return "TBA";
      return Number(n).toLocaleString(undefined, { style:"currency", currency:"USD", maximumFractionDigits:d });
    }

    function uniswapUrl(input, output){
      // Uniswap app (works for V2/V3 routing; you can still trade on V2 pools)
      const base = "https://app.uniswap.org/#/swap";
      const p = new URLSearchParams({ inputCurrency: input, outputCurrency: output });
      return `${base}?${p.toString()}`;
    }

    function setDexLinks(){
      const a1 = $("#dexWethToCapi");
      const a2 = $("#dexCapiToWeth");

      // Until TOKEN_ADDRESS exists, keep buttons inert (no broken links)
      if(!TOKEN_ADDRESS){
        [a1,a2].forEach(a=>{
          if(!a) return;
          a.href = "#";
          a.setAttribute("aria-disabled","true");
          a.classList.add("is-disabled");
        });
        return;
      }

      // Note: Uniswap uses ETH as the native input currency parameter.
      if(a1) a1.href = uniswapUrl("ETH", TOKEN_ADDRESS);     // WETH → CAPI (label)
      if(a2) a2.href = uniswapUrl(TOKEN_ADDRESS, "ETH");     // CAPI → WETH (label)
    }

    async function connectInjected(){
      if(!window.ethereum){
        alert("No injected wallet detected (MetaMask/Trust/Brave).");
        return;
      }
      const accounts = await window.ethereum.request({ method:"eth_requestAccounts" });
      const acc = accounts?.[0];
      $("#acct").textContent = short(acc);
      $("#accountPill").style.display = "inline-flex";
    }

    async function watchToken(){
      if(!TOKEN_ADDRESS){
        alert("Token address is still TBA.");
        return;
      }
      if(!window.ethereum){
        alert("MetaMask not detected.");
        return;
      }
      try{
        await window.ethereum.request({
          method: "wallet_watchAsset",
          params: {
            type: "ERC20",
            options: {
              address: TOKEN_ADDRESS,
              symbol: "CAPI",
              decimals: 18,
            },
          },
        });
      }catch(e){
        console.warn(e);
        alert("Could not add token to wallet.");
      }
    }

    async function loadDexScreener(){
      if(!TOKEN_ADDRESS) return;

      // DexScreener token endpoint
      const url = `https://api.dexscreener.com/latest/dex/tokens/${TOKEN_ADDRESS}`;
      const r = await fetch(url);
      if(!r.ok) return;
      const j = await r.json();
      const pairs = j?.pairs || [];

      // choose: if pair provided, match it; else take best by liquidity
      let p = null;
      if(DEX_PAIR_ADDRESS){
        p = pairs.find(x => (x?.pairAddress || "").toLowerCase() === DEX_PAIR_ADDRESS.toLowerCase()) || null;
      }
      if(!p){
        p = pairs.slice().sort((a,b) => (b?.liquidity?.usd||0) - (a?.liquidity?.usd||0))[0] || null;
      }
      if(!p) return;

      $("#m_price").textContent = fmtUSD(p.priceUsd, 8);
      $("#m_liq").textContent = fmtUSD(p?.liquidity?.usd, 0);
      $("#m_vol").textContent = fmtUSD(p?.volume?.h24, 0);

      // market cap is not always provided; show fdv if present
      const mc = p?.marketCap ?? p?.fdv ?? null;
      $("#m_mc").textContent = mc ? fmtUSD(mc, 0) : "TBA";

      // Recent activity placeholder → can later map buys/sells if needed
      $("#txBody").innerHTML = `
        <tr>
          <td class="mono">${short(p?.pairAddress || "TBA")}</td>
          <td class="mono">Liquidity pool</td>
          <td>${p?.txns?.h24 ? (p.txns.h24.buys + p.txns.h24.sells) : "TBA"}</td>
          <td class="mono"><a href="${p.url}" target="_blank" rel="noreferrer">Open pair</a></td>
        </tr>
      `;
    }

    function hydrateLaunchPanel(){
      // Contract / pair text
      if($("#contractText")) $("#contractText").textContent = TOKEN_ADDRESS ? TOKEN_ADDRESS : "TBA — verify only here";
      if($("#pairText")) $("#pairText").textContent = DEX_PAIR_ADDRESS ? DEX_PAIR_ADDRESS : "TBA";

      // Copy buttons
      $("#copyContractBtn")?.addEventListener("click", ()=> copyText(TOKEN_ADDRESS));
      $("#copyPairBtn")?.addEventListener("click", ()=> copyText(DEX_PAIR_ADDRESS));

      // Wallet
      $("#connectWalletBtn")?.addEventListener("click", connectInjected);
      $("#watchTokenBtn")?.addEventListener("click", (e)=>{ e.preventDefault(); watchToken(); });

      // Disable verify links until you publish verify page + addresses
      if(!TOKEN_ADDRESS){
        $("#verifyContractBtn")?.setAttribute("aria-disabled","true");
      }
      if(!DEX_PAIR_ADDRESS){
        $("#verifyPairBtn")?.setAttribute("aria-disabled","true");
      }

      setDexLinks();
    }

    document.addEventListener("DOMContentLoaded", async ()=>{
      hydrateLaunchPanel();
      

      // Try live data (safe: will do nothing until TOKEN_ADDRESS is set)
      await loadDexScreener();
      setInterval(loadDexScreener, 45000);
    });
  </script>

  <!-- Minimal UI helpers (safe/no dependencies) -->
  <div id="toast" class="toast" aria-live="polite"></div>
</BaseLayout>
