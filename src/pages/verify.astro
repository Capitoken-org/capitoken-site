---
/**
 * Capitoken /verify — Single Source of Truth + Trust Logic (Hardened)
 * - Works with Astro base path (e.g., /capitoken-site/)
 * - Reads official registry from: /official-registry.json (served from public/)
 * - Shows mirror warning if hostname is not allowed
 * - HARDENING (Option 2):
 *   - On mirrors: disable trading/market/pair buttons + disable external trade links
 *   - On mirrors: apply strict Trust Score cap
 */

const BASE = import.meta.env.BASE_URL; // respects astro.config.mjs "base"
const FALLBACK = {
  project: "Capitoken",
  version: "1.0.0",
  updatedAt: "2026-01-17",
  officialDomain: "www.capitoken.org",
  allowedDomains: ["www.capitoken.org", "capitoken.org"],
  officialRepo: "https://github.com/capitoken-org/capitoken-site",
  network: { name: "Ethereum Mainnet", chainId: 1, explorer: "https://etherscan.io" },
  contract: {
    address: "0xF2dA6C9B945c688A52D3B72340E622014920de6a",
    verified: true,
    token: { name: "Capitoken", symbol: "CAPI", decimals: 18 }
  },
  // Fallback pair + links (keeps /verify functional even if registry fetch fails)
  pair: {
    address: "0xb96808b1270A89eA8A237d52df389619f347AeA2",
    dex: "Uniswap V2",
    chain: "ethereum"
  },
  links: {
    site: "https://www.capitoken.org",
    verify: "https://www.capitoken.org/verify",
    // Canonical Uniswap swap link for WETH -> CAPI
    buy: "https://app.uniswap.org/swap?inputCurrency=0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2&outputCurrency=0xF2dA6C9B945c688A52D3B72340E622014920de6a",
    // Canonical Dexscreener pair page
    market: "https://dexscreener.com/ethereum/0xb96808b1270A89eA8A237d52df389619f347AeA2"
  },
  security: {
    mirrorsAllowed: true,
    mirrorNotice: "You are viewing a mirror. The official site is https://www.capitoken.org"
  }
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Verify | Capitoken</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Respect base path -->
    <link rel="stylesheet" href={`${BASE}global.css`} />

    <style>
      /* /verify polish (keeps existing layout) */
      .scorewrap{display:flex;flex-direction:column;gap:10px;margin-top:10px}
      .bar{height:10px;border-radius:999px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.10);overflow:hidden}
      .barfill{height:100%;width:0%;background:linear-gradient(90deg, rgba(241,196,15,1), rgba(46,204,113,1));transition:width .85s ease}

      .wrap { max-width: 920px; margin: 80px auto; padding: 0 18px; }
      .h1 { font-size: clamp(28px, 4vw, 44px); line-height: 1.1; margin: 0 0 10px; }
      .sub { opacity:.85; margin: 0 0 18px; }
      .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
      .cardx{
        grid-column: span 12;
        background: rgba(0,0,0,.55);
        border: 1px solid rgba(255,255,255,.10);
        border-radius: 14px;
        padding: 18px;
        backdrop-filter: blur(8px);
      }
      .row { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }

      /* ✅ Badge harmony: more space + wrap */
      .badgeRow{display:flex;align-items:center;gap:12px 12px;flex-wrap:wrap;margin-top:6px}
      .tag {
        display:inline-flex; align-items:center; gap:6px;
        font-size: 12px; padding: 7px 12px;
        border-radius: 999px;
        border:1px solid rgba(255,255,255,.14);
        background: rgba(255,255,255,.05);
        line-height: 1;
        white-space: nowrap;
      }
      .tag.ok{background: rgba(46,204,113,.10); border-color: rgba(46,204,113,.25)}
      .tag.warn{background: rgba(241,196,15,.10); border-color: rgba(241,196,15,.25)}
      .tag.bad{background: rgba(231,76,60,.10); border-color: rgba(231,76,60,.25)}

      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; word-break: break-all; }
      .ok { color:#2ecc71; }
      .warn { color:#f1c40f; }
      .bad { color:#e74c3c; }
      .btns { display:flex; gap:10px; flex-wrap:wrap; }
      .btnx{
        display:inline-flex; align-items:center; justify-content:center;
        padding:10px 14px; border-radius:12px;
        border:1px solid rgba(255,255,255,.14);
        background: rgba(255,255,255,.06);
        text-decoration:none; font-weight:700;
        cursor: pointer;
      }
      .btnx:hover{ transform: translateY(-1px); }
      .primary{ background: rgba(233,144,44,.18); border-color: rgba(233,144,44,.30); }
      .small { font-size: 13px; opacity:.85; }
      .kvs { display:grid; grid-template-columns: 180px 1fr; gap: 10px 14px; }
      @media (max-width: 640px){ .kvs{ grid-template-columns: 1fr; } }
      .hr { height:1px; background: rgba(255,255,255,.10); border:0; margin: 14px 0; }
      .score { font-size: 34px; font-weight: 900; }
      .muted { opacity: .7; }
      .notice{ border-color: rgba(255,200,0,.35); background: rgba(255,200,0,.06); }
      .footer { margin-top: 18px; opacity: .7; font-size: 12px; }

      /* ✅ Hardening UI: disabled buttons/links on mirrors */
      .disabledBtn{
        opacity: .55;
        filter: grayscale(1);
        cursor: not-allowed !important;
        transform: none !important;
      }
      .disabledBtn:hover{ transform:none !important; }
      .lockNote{
        margin-top: 10px;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(231,76,60,.28);
        background: rgba(231,76,60,.08);
        font-size: 13px;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <!-- Icon removed: avoids broken/missing asset rendering on some mirrors/builds -->
      <h1 class="h1">Verify Capitoken</h1>
      <p class="sub">Single source of truth for official domain, contract and links. If anything disagrees with this page, treat it as <b>not official</b>.</p>

      <!-- Mirror banner -->
      <div id="mirrorBanner" class="cardx notice" style="display:none;">
        <div class="row">
          <div>
            <div style="font-weight:900;">⚠ Mirror detected</div>
            <div class="small" id="mirrorText"></div>
          </div>
          <div class="btns">
            <a class="btnx primary" href="https://www.capitoken.org/verify" target="_blank" rel="noreferrer">Open Official /verify</a>
          </div>
        </div>
        <div class="lockNote" id="mirrorLockNote" style="display:none;">
          <b>Hardening active:</b> Trading and external market links are disabled on mirrors. Use only the official domain.
        </div>
      </div>

      <div class="grid" style="margin-top:14px;">
        <!-- Status / Score -->
        <div class="cardx" style="grid-column: span 12;">
          <div class="row">
            <div>
              <div class="badgeRow">
                <div class="tag" id="domainTag">Checking domain…</div>
                <div class="tag" id="chainTag">Checking chain…</div>
                <div class="tag" id="contractTag">Checking contract…</div>
                <div class="tag" id="pairTag">Checking pair…</div>
                <div class="tag" id="linksTag">Checking links…</div>
              </div>
            </div>
            <div>
              <span class="muted">Trust Score</span>
              <span class="score" id="trustScore">—</span>
            </div>
          </div>
          <hr class="hr" />
          <div class="kvs">
            <div class="muted">Official Domain</div>
            <div><a id="officialDomainLink" href="#" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Network</div>
            <div id="networkName">—</div>

            <div class="muted">DEX Pair</div>
            <div>
              <a class="mono" id="pairLink" href="#" target="_blank" rel="noreferrer">—</a>
              <span class="muted" id="pairDex"></span>
            </div>

            <div class="muted">Token</div>
            <div><span id="tokenName">—</span> (<span id="tokenSymbol">—</span>) · Decimals: <span id="tokenDecimals">—</span></div>
          </div>
        </div>

        <!-- Hard checks (immutable) -->
        <div class="cardx" style="grid-column: span 12;">
          <div style="font-weight:900;">Hard Verification Checks</div>
          <p class="small">These values are hardcoded in this page. If any value below differs, treat the page as <b>NOT official</b> and use only the official domain.</p>
          <div class="kvs" style="margin-top:10px;">
            <div class="muted">Host domain</div>
            <div><span class="mono" id="runtimeHost">—</span> <span class="muted">(must be official)</span></div>

            <div class="muted">Chain ID</div>
            <div><span class="mono" id="runtimeChain">—</span> <span class="muted">(expected <span class="mono" id="immChain">—</span>)</span></div>

            <div class="muted">Contract</div>
            <div><span class="mono" id="runtimeContract">—</span> <span class="muted">(expected <span class="mono" id="immContract">—</span>)</span></div>

            <div class="muted">DEX Pair</div>
            <div><span class="mono" id="runtimePair">—</span> <span class="muted">(expected <span class="mono" id="immPair">—</span>)</span></div>
          </div>
        </div>

        <!-- Contract -->
        <div class="cardx" style="grid-column: span 12;">
          <div class="row">
            <div>
              <div style="font-weight:900;">Official Contract</div>
              <div class="mono" id="contractAddr">—</div>
            </div>
            <div class="btns">
              <button class="btnx" id="copyContract" type="button">Copy</button>
              <a class="btnx primary" id="openEtherscan" target="_blank" rel="noreferrer">Open Etherscan</a>
              <a class="btnx" id="addTokenHint" target="_blank" rel="noreferrer" href="https://support.metamask.io/manage-crypto/tokens/how-to-display-tokens-in-metamask/">How to add token</a>
            </div>
          </div>

          <div class="footer">
            Security rule: if the contract differs from <span class="mono">0xF2dA6C9B945c688A52D3B72340E622014920de6a</span> → NOT official.
          </div>
        </div>

        <!-- DEX Pair (official) -->
        <div class="cardx" style="grid-column: span 12;">
          <div class="row">
            <div>
              <div style="font-weight:900;">Official DEX Pair</div>
              <div class="mono" id="pairAddr">—</div>
              <div class="small muted" id="pairMeta">—</div>
            </div>
            <div class="btns">
              <button class="btnx" id="copyPair" type="button">Copy</button>
              <a class="btnx" id="openPairEtherscan" target="_blank" rel="noreferrer">Open Pair</a>
              <a class="btnx primary" id="openDexscreener" target="_blank" rel="noreferrer">Open Dexscreener</a>
              <a class="btnx" id="openUniswap" target="_blank" rel="noreferrer">Open Uniswap</a>
            </div>
          </div>

          <div class="footer">
            Security rule: only trade if the pair matches <span class="mono">0xb96808b1270A89eA8A237d52df389619f347AeA2</span>.
          </div>
        </div>

        <!-- Official Links -->
        <div class="cardx" style="grid-column: span 12;">
          <div style="font-weight:900;">Official Links</div>
          <p class="small">Only these sources are considered official. Mirrors may exist, but the official domain remains <b>capitoken.org</b>.</p>
          <div class="kvs" style="margin-top:10px;">
            <div class="muted">Official Website</div>
            <div><a id="siteLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">GitHub (source)</div>
            <div><a id="repoLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Etherscan Token</div>
            <div><a id="etherscanTokenLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Etherscan Pair</div>
            <div><a id="etherscanPairLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Official /verify</div>
            <div><a id="verifyLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Buy (Uniswap)</div>
            <div><a id="buyLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Live Market</div>
            <div><a id="marketLink" target="_blank" rel="noreferrer">—</a></div>

            <div class="muted">Mirror (GitHub Pages)</div>
            <div><a id="mirrorLink" target="_blank" rel="noreferrer">—</a></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast" aria-live="polite" style="position:fixed;left:16px;bottom:16px;opacity:0;transform:translateY(8px);transition:all .2s;pointer-events:none;background:rgba(0,0,0,.75);border:1px solid rgba(255,255,255,.15);padding:10px 12px;border-radius:12px;font-size:.95rem;z-index:9999;"></div>

    <!-- ✅ define:vars injects BASE and FALLBACK -->
    <script type="module" define:vars={{ BASE, FALLBACK }}>
      const IMMUTABLE = {
        officialDomain: "www.capitoken.org",
        chainId: 1,
        contract: "0xF2dA6C9B945c688A52D3B72340E622014920de6a",
        pair: "0xb96808b1270A89eA8A237d52df389619f347AeA2",
        weth: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
        officialVerify: "https://www.capitoken.org/verify"
      };

      const norm = (v) => String(v || "").trim().toLowerCase();
      const sameAddr = (a, b) => norm(a) === norm(b);

      function setText(id, v){ const el=document.getElementById(id); if(el) el.textContent = v ?? "—"; }
      function setHref(id, href, label){
        const el=document.getElementById(id);
        if(!el) return;
        el.href = href;
        el.textContent = label ?? href;
      }
      function addDisabled(el){
        if(!el) return;
        el.classList.add("disabledBtn");
        el.setAttribute("aria-disabled", "true");
        // Prevent clicks from navigating anywhere in mirror mode unless we explicitly set a safe target.
        el.addEventListener("click", (e) => {
          // allow Ctrl/cmd click to still open official verify if href is set to it
          const href = el.getAttribute("href") || "";
          if (href && href.startsWith(IMMUTABLE.officialVerify)) return;
          e.preventDefault();
          e.stopPropagation();
        }, { capture: true });
      }

      function toast(msg){
        const el = document.getElementById('toast');
        if(!el) return;
        el.textContent = msg;
        el.style.opacity = '1';
        el.style.transform = 'translateY(0)';
        clearTimeout(window.__toastT);
        window.__toastT = setTimeout(()=>{
          el.style.opacity = '0';
          el.style.transform = 'translateY(8px)';
        }, 1800);
      }

      async function copyText(val){
        if(!val) return false;
        try{
          await navigator.clipboard.writeText(val);
          toast('Copied');
          return true;
        }catch(e){
          try{
            const ta = document.createElement('textarea');
            ta.value = val;
            ta.setAttribute('readonly','');
            ta.style.position='absolute';
            ta.style.left='-9999px';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            ta.remove();
            toast('Copied');
            return true;
          }catch{
            toast('Copy failed');
            return false;
          }
        }
      }

      async function loadRegistry(){
        const url = BASE + "official-registry.json";
        try {
          const r = await fetch(url, { cache: "no-store" });
          if (!r.ok) throw new Error("registry fetch failed");
          return await r.json();
        } catch(e){
          return FALLBACK;
        }
      }

      (async function init(){
        const data = await loadRegistry();

        const host = window.location.hostname;
        const allowed = new Set((data.allowedDomains || []).map(x => String(x).toLowerCase()));
        const isOfficialHost = allowed.has(String(host).toLowerCase());

        // Mirror banner
        if (!isOfficialHost) {
          const b = document.getElementById("mirrorBanner");
          const t = document.getElementById("mirrorText");
          const ln = document.getElementById("mirrorLockNote");
          if (b) b.style.display = "block";
          if (t) t.textContent = (data.security?.mirrorNotice || "You are viewing a mirror. The official site is https://www.capitoken.org")
            + " — DO NOT connect wallets or trust links on mirrors.";
          if (ln) ln.style.display = "block";
        }

        const chainOk = Number(data.network?.chainId) === IMMUTABLE.chainId;
        const addr = data.contract?.address || "";
        const contractOk = sameAddr(addr, IMMUTABLE.contract);
        const pairAddr = data.pair?.address || "";
        const pairOk = sameAddr(pairAddr, IMMUTABLE.pair);
        const domainCfgOk = norm(data.officialDomain) === norm(IMMUTABLE.officialDomain);

        // Tags
        const domainTag = document.getElementById("domainTag");
        if (domainTag) {
          if (!isOfficialHost) {
            domainTag.textContent = "✖ Mirror domain";
            domainTag.className = "tag bad";
          } else if (!domainCfgOk) {
            domainTag.textContent = "✖ Registry domain mismatch";
            domainTag.className = "tag bad";
          } else {
            domainTag.textContent = "✔ Official domain";
            domainTag.className = "tag ok";
          }
        }

        const chainTag = document.getElementById("chainTag");
        if (chainTag) {
          chainTag.textContent = chainOk ? "✔ Ethereum Mainnet" : "✖ Wrong network";
          chainTag.className = "tag " + (chainOk ? "ok" : "bad");
        }

        const contractTag = document.getElementById("contractTag");
        if (contractTag) {
          contractTag.textContent = contractOk ? "✔ Contract matches" : "✖ Contract mismatch";
          contractTag.className = "tag " + (contractOk ? "ok" : "bad");
        }

        const pairTag = document.getElementById("pairTag");
        if (pairTag) {
          const hasPair = Boolean(pairAddr);
          const ok = hasPair && pairOk;
          pairTag.textContent = ok ? "✔ Pair matches" : (hasPair ? "✖ Pair mismatch" : "⚠ Pair missing");
          pairTag.className = "tag " + (ok ? "ok" : (hasPair ? "bad" : "warn"));
        }

        // Canonical links
        const explorer = data.network?.explorer || "https://etherscan.io";
        const etherscanToken = addr ? `${explorer}/token/${addr}` : explorer;
        const pairExplorer = pairAddr ? `${explorer}/address/${pairAddr}` : "";

        const buyCanonical = addr
          ? `https://app.uniswap.org/swap?inputCurrency=${IMMUTABLE.weth}&outputCurrency=${addr}`
          : "";
        const marketCanonical = pairAddr ? `https://dexscreener.com/ethereum/${pairAddr}` : "";

        const buyLinkFromRegistry = data.links?.buy || "";
        const marketLinkFromRegistry = data.links?.market || "";

        const buyOk = buyLinkFromRegistry
          ? (norm(buyLinkFromRegistry).includes(norm(addr)) && norm(buyLinkFromRegistry).includes(norm(IMMUTABLE.weth)))
          : false;
        const marketOk = marketLinkFromRegistry
          ? (norm(marketLinkFromRegistry).includes(norm(pairAddr)) && norm(marketLinkFromRegistry).includes("dexscreener.com/ethereum"))
          : false;
        const linksMatch = buyOk && marketOk;

        const linksTag = document.getElementById("linksTag");
        if (linksTag) {
          if (!isOfficialHost) {
            linksTag.textContent = "✖ Links disabled on mirror";
            linksTag.className = "tag bad";
          } else {
            linksTag.textContent = linksMatch ? "✔ Links match" : "⚠ Links adjusted";
            linksTag.className = "tag " + (linksMatch ? "ok" : "warn");
          }
        }

        // Trust score (hardened)
        let score = 0;
        if (isOfficialHost) score += 25;
        if (domainCfgOk) score += 10;
        if (chainOk) score += 15;
        if (contractOk) score += 25;
        if (data.contract?.verified) score += 10;
        if (pairOk) score += 15;
        if (linksMatch) score += 0; // links match is informative only (no score boost)

        score = Math.min(100, score);

        // ✅ Option 2 hardening: strict mirror cap
        if (!isOfficialHost) {
          score = Math.min(score, 45);
        }

        setText("trustScore", String(score));

        // Hard checks table
        setText("runtimeHost", host || "—");
        setText("runtimeChain", String(data.network?.chainId ?? "—"));
        setText("runtimeContract", addr || "—");
        setText("runtimePair", pairAddr || "—");
        setText("immChain", String(IMMUTABLE.chainId));
        setText("immContract", IMMUTABLE.contract);
        setText("immPair", IMMUTABLE.pair);

        // Core fields
        const officialUrl = "https://" + (data.officialDomain || "www.capitoken.org");
        setHref("officialDomainLink", officialUrl, officialUrl);
        setText("networkName", data.network?.name || "—");
        setText("tokenName", data.contract?.token?.name || "—");
        setText("tokenSymbol", data.contract?.token?.symbol || "—");
        setText("tokenDecimals", String(data.contract?.token?.decimals ?? "—"));
        setText("contractAddr", addr);

        // Buttons / links
        const openE = document.getElementById("openEtherscan");
        if (openE) openE.href = etherscanToken;

        // Pair KV
        setHref("pairLink", pairExplorer || "#", pairAddr || "—");
        setText("pairDex", data.pair?.dex ? `(${data.pair.dex})` : "");

        // Pair card
        setText("pairAddr", pairAddr || "—");
        setText("pairMeta", data.pair?.dex ? `${data.pair.dex}${data.pair?.chain ? ` · ${data.pair.chain}` : ""}` : (data.pair?.chain || "—"));

        const openPair = document.getElementById("openPairEtherscan");
        const openDex = document.getElementById("openDexscreener");
        const openUni = document.getElementById("openUniswap");

        // Official links (always show)
        setHref("repoLink", data.officialRepo || "https://github.com/capitoken-org/capitoken-site");
        setHref("siteLink", data.links?.site || "https://www.capitoken.org", data.links?.site || "https://www.capitoken.org");
        setHref("etherscanTokenLink", data.links?.etherscanToken || etherscanToken, data.links?.etherscanToken || etherscanToken);
        setHref(
          "etherscanPairLink",
          data.links?.etherscanPair || pairExplorer || "#",
          data.links?.etherscanPair || pairExplorer || "—"
        );
        setHref(
          "verifyLink",
          data.links?.verify || IMMUTABLE.officialVerify,
          data.links?.verify || IMMUTABLE.officialVerify
        );

        // For official host: use canonical/registry; for mirror: LOCK to official verify
        const buyLink = linksMatch ? (buyLinkFromRegistry || buyCanonical) : buyCanonical;
        const marketLink = linksMatch ? (marketLinkFromRegistry || marketCanonical) : marketCanonical;

        const buyEl = document.getElementById("buyLink");
        const marketEl = document.getElementById("marketLink");
        const pairKvEl = document.getElementById("pairLink");

        if (!isOfficialHost) {
          // ✅ Hardening Option 2: disable external trading links on mirrors
          if (openPair) { openPair.href = IMMUTABLE.officialVerify; addDisabled(openPair); }
          if (openDex)  { openDex.href  = IMMUTABLE.officialVerify; addDisabled(openDex); }
          if (openUni)  { openUni.href  = IMMUTABLE.officialVerify; addDisabled(openUni); }

          if (buyEl)   { buyEl.href   = IMMUTABLE.officialVerify; buyEl.textContent = IMMUTABLE.officialVerify; addDisabled(buyEl); }
          if (marketEl){ marketEl.href = IMMUTABLE.officialVerify; marketEl.textContent = IMMUTABLE.officialVerify; addDisabled(marketEl); }
          if (pairKvEl){ pairKvEl.href = IMMUTABLE.officialVerify; addDisabled(pairKvEl); }
        } else {
          if (openPair) openPair.href = pairExplorer || "#";
          if (openDex)  openDex.href  = marketLink || "#";
          if (openUni)  openUni.href  = buyLink || "#";

          if (buyEl)   { buyEl.href = buyLink || "#"; buyEl.textContent = buyLink || "—"; }
          if (marketEl){ marketEl.href = marketLink || "#"; marketEl.textContent = marketLink || "—"; }
        }

        // Mirror link (always show github pages)
        setHref("mirrorLink", "https://capitoken-org.github.io/capitoken-site/", "https://capitoken-org.github.io/capitoken-site/");

        // Copy handlers
        const copyPairBtn = document.getElementById("copyPair");
        if (copyPairBtn) {
          copyPairBtn.addEventListener("click", async () => {
            copyPairBtn.textContent = "Copying…";
            const ok = await copyText(pairAddr);
            copyPairBtn.textContent = "Copy";
            if (!ok) toast("Copy failed");
          });
        }

        const copyBtn = document.getElementById("copyContract");
        if (copyBtn) {
          copyBtn.addEventListener("click", async () => {
            copyBtn.textContent = "Copying…";
            const ok = await copyText(addr);
            copyBtn.textContent = "Copy";
            if (!ok) toast("Copy failed");
          });
        }
      })();
    </script>
  </body>
</html>
